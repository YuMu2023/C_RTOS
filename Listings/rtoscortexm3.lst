


ARM Macro Assembler    Page 1 


    1 00000000                 IMPORT           rtos_current_thread_sp_p
    2 00000000                 IMPORT           rtos_next_thread_sp_p
    3 00000000                 IMPORT           rtos_is_first_schedule
    4 00000000                 IMPORT           rtos_current_thread_p
    5 00000000                 IMPORT           rtos_next_thread_p
    6 00000000         
    7 00000000 E000ED04 
                       RTOS_ICSR
                               EQU              0xE000ED04  ;ä¸­æ–­æ§åˆ¶åŠçŠ¶
                                                            æ€å¯„å­˜å™¨åœ°å€
    8 00000000 E000ED20 
                       RTOS_SYSEPR3
                               EQU              0xE000ED20  ;ç³»ç»Ÿå¼‚å¸¸ä¼˜å…ˆ
                                                            çº§å¯„å­˜å™¨é˜µåˆ—ä
                                                            ¸­ï¼ŒPendSVä¼˜å…ˆçº
                                                            §æ‰€åœ¨å­—çš„åœ°å€
                                                            
    9 00000000 00FF0000 
                       RTOS_PENDSV_PRI
                               EQU              0x00FF0000  ;PendSVä¼˜å…ˆçº§ï¼ˆ
                                                            æœ€ä½ï¼‰
   10 00000000 10000000 
                       RTOS_PENDSV_SET
                               EQU              0x10000000  ;è§¦å‘PendSVä¸­æ–­
                                                            çš„å€¼
   11 00000000         
   12 00000000         
   13 00000000                 AREA             |.text|, CODE, READONLY
   14 00000000         
   15 00000000         rtos_first_schedule
                               PROC                         ;RTOSç¬¬ä¸€æ¬¡è°ƒåº
                                                            ¦
   16 00000000         
   17 00000000                 EXPORT           rtos_first_schedule
   18 00000000         
   19 00000000 481E            LDR              R0, =RTOS_SYSEPR3
   20 00000002 F44F 017F       LDR              R1, =RTOS_PENDSV_PRI
   21 00000006 F8D0 2000       LDR.W            R2, [R0]    ;è¯»å–PendSVä¼˜å…ˆ
                                                            çº§æ‰€åœ¨å­—
   22 0000000A EA41 0102       ORR              R1, R1, R2  ;ç»™PendSVæ‰€åœ¨å­—
                                                            èŠ‚è¿›è¡Œä¼˜å…ˆçº§è
                                                            ®¾ç½®ï¼ŒåŒæ—¶ä¸æ”
                                                            ¹åŠ¨å…¶ä»–å­—èŠ‚
   23 0000000E 6001            STR              R1, [R0]    ;å†™å›å­—
   24 00000010         
   25 00000010 481B            LDR              R0, =RTOS_ICSR
   26 00000012 F04F 5180       LDR              R1, =RTOS_PENDSV_SET
   27 00000016 F8D0 2000       LDR.W            R2, [R0]    ;è¯»å–ç³»ç»Ÿä¸­æ–­
                                                            æ§åˆ¶åŠçŠ¶æ€å¯„å
                                                            ­˜å™¨å­—
   28 0000001A EA41 0102       ORR              R1, R1, R2  ;ç»™PendSVæ‰€åœ¨ä½
                                                            æ®µç½®ä½
   29 0000001E 6001            STR              R1, [R0]    ;å†™å›ï¼Œè§¦å‘Pen
                                                            dSvä¸­æ–­
   30 00000020         
   31 00000020 B662            CPSIE            I
   32 00000022 B661            CPSIE            F
   33 00000024         
   34 00000024                 ENDP



ARM Macro Assembler    Page 2 


   35 00000024         
   36 00000024         
   37 00000024         
   38 00000024         
   39 00000024         rtos_normal_schedule
                               PROC
   40 00000024         
   41 00000024                 EXPORT           rtos_normal_schedule
   42 00000024         
   43 00000024 4816            LDR              R0, =RTOS_ICSR
   44 00000026 F04F 5180       LDR              R1, =RTOS_PENDSV_SET
   45 0000002A F8D0 2000       LDR.W            R2, [R0]    ;è¯»å–ç³»ç»Ÿä¸­æ–­
                                                            æ§åˆ¶åŠçŠ¶æ€å¯„å
                                                            ­˜å™¨å­—
   46 0000002E EA41 0102       ORR              R1, R1, R2  ;ç»™PendSVæ‰€åœ¨ä½
                                                            æ®µç½®ä½
   47 00000032 6001            STR              R1, [R0]    ;å†™å›ï¼Œè§¦å‘Pen
                                                            dSvä¸­æ–­
   48 00000034         
   49 00000034 4770            BX               LR
   50 00000036         
   51 00000036                 ENDP
   52 00000036         
   53 00000036         
   54 00000036         
   55 00000036         
   56 00000036         PendSV_Handler
                               PROC
   57 00000036         
   58 00000036                 EXPORT           PendSV_Handler
   59 00000036         
   60 00000036 F3EF 8210       MRS              R2, PRIMASK ;ä¿å­˜å±è”½å¯„å­˜
                                                            å™¨
   61 0000003A B672            CPSID            I           ;å…³é—­ä¸­æ–­
   62 0000003C         
   63 0000003C 4911            LDR              R1, =rtos_is_first_schedule ;è
                                                            ·å–rtos_is_first_s
                                                            cheduleåœ°å€
   64 0000003E 6808            LDR              R0, [R1]    ;å–å€¼
   65 00000040 F240 0301       MOVW             R3, #1
   66 00000044 4298            CMP              R0, R3      ;åˆ¤æ–­rtos_is_firs
                                                            t_scheduleæ˜¯å¦ä¸º
                                                            1
   67 00000046 F240 0300       MOVW             R3, #0
   68 0000004A 600B            STR              R3, [R1]    ;rtos_is_first_sche
                                                            dule = 0
   69 0000004C D006            BEQ              recover_next_thread_reg ;ä¸º1åˆ
                                                            ™è·³è½¬ï¼ˆå³ä¸éœ€
                                                            è¦ä¿å­˜å½“å‰å¯„å
                                                            ­˜å™¨ï¼‰
   70 0000004E         
   71 0000004E         save_current_thread_reg
   72 0000004E         
   73 0000004E F3EF 8109       MRS              R1, PSP     ;è·å–å½“å‰çº¿ç¨‹
                                                            PSP
   74 00000052 E921 0FF0       STMDB            R1!, {R4 - R11} ;è¿›å…¥ä¸­æ–­ä¼
                                                            šä¿å­˜é™¤R4 - R11ä
                                                            »¥å¤–çš„å¯„å­˜å™¨
   75 00000056 480C            LDR              R0, =rtos_current_thread_sp_p



ARM Macro Assembler    Page 3 


   76 00000058 6800            LDR              R0, [R0]    ;è·å–å½“å‰çº¿ç¨‹
                                                            PSPåœ°å€
   77 0000005A 6001            STR              R1, [R0]    ;ç›¸å½“äºä½¿ç”¨PSP
                                                            è¿›è¡Œæ ˆæ“ä½œï¼ˆä
                                                            ¸­æ–­ä¸­ä½¿ç”¨MSPï¼
                                                            ‰
   78 0000005C         
   79 0000005C         recover_next_thread_reg
   80 0000005C         
   81 0000005C 480B            LDR              R0, =rtos_next_thread_sp_p
   82 0000005E 6800            LDR              R0, [R0]
   83 00000060 6800            LDR              R0, [R0]    ;è·å–ä¸‹ä¸€ä¸ªçº¿
                                                            ç¨‹PSPçš„å€¼
   84 00000062 E8B0 0FF0       LDMIA            R0!, {R4 - R11} ;æ‰‹åŠ¨å¯¹R4 - 
                                                            R11å‡ºæ ˆ
   85 00000066 F380 8809       MSR              PSP, R0     ;å‡ºæ ˆåï¼Œèµ‹å€¼
                                                            ç»™ç‰©ç†PSP
   86 0000006A         
   87 0000006A         pendsv_end
   88 0000006A         
   89 0000006A 4809            LDR              R0, =rtos_current_thread_p
   90 0000006C 4909            LDR              R1, =rtos_next_thread_p
   91 0000006E 6809            LDR              R1, [R1]
   92 00000070 6001            STR              R1, [R0]    ;æ›´æ¢å½“å‰çº¿ç¨‹
                                                            æŒ‡é’ˆ  
   93 00000072         
   94 00000072 F382 8810       MSR              PRIMASK, R2 ;æ¢å¤ä¸­æ–­
   95 00000076         
   96 00000076 F04E 0E04       ORR              LR, LR, #0x04 ;LRä½2ç½®1è¡¨ç¤º
                                                            ä¸­æ–­ç»“æŸåä½¿ç
                                                            ”¨PSP
   97 0000007A 4770            BX               LR
   98 0000007C         
   99 0000007C                 ENDP
  100 0000007C         
  101 0000007C                 ALIGN            4
  102 0000007C         
  103 0000007C                 END
              E000ED20 
              E000ED04 
              00000000 
              00000000 
              00000000 
              00000000 
              00000000 
Command Line: --debug --xref --diag_suppress=9931 --cpu=Cortex-M3 --apcs=interw
ork --depend=.\objects\rtoscortexm3.d -o.\objects\rtoscortexm3.o -I.\RTE\_Targe
t_1 -ID:\Keil5\ARM\PACK\Keil\STM32F1xx_DFP\2.2.0\Device\Include -ID:\Keil5\ARM\
CMSIS\Include --predefine="__UVISION_VERSION SETA 524" --predefine="STM32F10X_M
D SETA 1" --list=.\listings\rtoscortexm3.lst RTOS\rtosCortexM3.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

.text 00000000

Symbol: .text
   Definitions
      At line 13 in file RTOS\rtosCortexM3.s
   Uses
      None
Comment: .text unused
PendSV_Handler 00000036

Symbol: PendSV_Handler
   Definitions
      At line 56 in file RTOS\rtosCortexM3.s
   Uses
      At line 58 in file RTOS\rtosCortexM3.s
Comment: PendSV_Handler used once
pendsv_end 0000006A

Symbol: pendsv_end
   Definitions
      At line 87 in file RTOS\rtosCortexM3.s
   Uses
      None
Comment: pendsv_end unused
recover_next_thread_reg 0000005C

Symbol: recover_next_thread_reg
   Definitions
      At line 79 in file RTOS\rtosCortexM3.s
   Uses
      At line 69 in file RTOS\rtosCortexM3.s
Comment: recover_next_thread_reg used once
rtos_first_schedule 00000000

Symbol: rtos_first_schedule
   Definitions
      At line 15 in file RTOS\rtosCortexM3.s
   Uses
      At line 17 in file RTOS\rtosCortexM3.s
Comment: rtos_first_schedule used once
rtos_normal_schedule 00000024

Symbol: rtos_normal_schedule
   Definitions
      At line 39 in file RTOS\rtosCortexM3.s
   Uses
      At line 41 in file RTOS\rtosCortexM3.s
Comment: rtos_normal_schedule used once
save_current_thread_reg 0000004E

Symbol: save_current_thread_reg
   Definitions
      At line 71 in file RTOS\rtosCortexM3.s
   Uses
      None
Comment: save_current_thread_reg unused
7 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

RTOS_ICSR E000ED04

Symbol: RTOS_ICSR
   Definitions
      At line 7 in file RTOS\rtosCortexM3.s
   Uses
      At line 25 in file RTOS\rtosCortexM3.s
      At line 43 in file RTOS\rtosCortexM3.s

RTOS_PENDSV_PRI 00FF0000

Symbol: RTOS_PENDSV_PRI
   Definitions
      At line 9 in file RTOS\rtosCortexM3.s
   Uses
      At line 20 in file RTOS\rtosCortexM3.s
Comment: RTOS_PENDSV_PRI used once
RTOS_PENDSV_SET 10000000

Symbol: RTOS_PENDSV_SET
   Definitions
      At line 10 in file RTOS\rtosCortexM3.s
   Uses
      At line 26 in file RTOS\rtosCortexM3.s
      At line 44 in file RTOS\rtosCortexM3.s

RTOS_SYSEPR3 E000ED20

Symbol: RTOS_SYSEPR3
   Definitions
      At line 8 in file RTOS\rtosCortexM3.s
   Uses
      At line 19 in file RTOS\rtosCortexM3.s
Comment: RTOS_SYSEPR3 used once
4 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
External symbols

rtos_current_thread_p 00000000

Symbol: rtos_current_thread_p
   Definitions
      At line 4 in file RTOS\rtosCortexM3.s
   Uses
      At line 89 in file RTOS\rtosCortexM3.s
Comment: rtos_current_thread_p used once
rtos_current_thread_sp_p 00000000

Symbol: rtos_current_thread_sp_p
   Definitions
      At line 1 in file RTOS\rtosCortexM3.s
   Uses
      At line 75 in file RTOS\rtosCortexM3.s
Comment: rtos_current_thread_sp_p used once
rtos_is_first_schedule 00000000

Symbol: rtos_is_first_schedule
   Definitions
      At line 3 in file RTOS\rtosCortexM3.s
   Uses
      At line 63 in file RTOS\rtosCortexM3.s
Comment: rtos_is_first_schedule used once
rtos_next_thread_p 00000000

Symbol: rtos_next_thread_p
   Definitions
      At line 5 in file RTOS\rtosCortexM3.s
   Uses
      At line 90 in file RTOS\rtosCortexM3.s
Comment: rtos_next_thread_p used once
rtos_next_thread_sp_p 00000000

Symbol: rtos_next_thread_sp_p
   Definitions
      At line 2 in file RTOS\rtosCortexM3.s
   Uses
      At line 81 in file RTOS\rtosCortexM3.s
Comment: rtos_next_thread_sp_p used once
5 symbols
350 symbols in table
